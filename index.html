<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no">
    <title>언약교회 건물 원정대</title>
    <script type="text/javascript" src="https://oapi.map.naver.com/openapi/v3/maps.js?ncpClientId=9y9khjbeqw"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.22.3/dist/bootstrap-table.min.css">
    <link rel="icon" type="image/x-icon" href="https://images.squarespace-cdn.com/content/v1/6151f74fe491d90282ef3789/3fbd4ad5-5dd1-4efd-872c-073fa9f09434/favicon.ico?format=100w">
</head>
<body>
    <div class="container">
        <h1>언약교회 </h1>
        <div>https://yellow-sand-0f7b03110.5.azurestaticapps.net/</div>
        <div>filters</div>

        <div class="row">
            <div class="col">
                <div id="map" style="width:100%;height:400px;" class="mb-3"></div>
            </div>
            <div class="col">
                <div>images</div>
            </div>
        </div>

        <div class="row">
            <table class="table table-striped table-hover"
                id="table"
                data-toggle="table"
                data-url="data1.json">
                <thead>
                    <tr>
                      <th scope="col" data-field="num">#</th>
                      <th scope="col" data-field="name">이름</th>
                      <th scope="col" data-field="price">가격</th>
                      <th scope="col" data-field="cat">건물</th>
                      <th scope="col" data-field="floors">층</th>
                      <th scope="col" data-field="area1">대지</th>
                      <th scope="col" data-field="area2">건평</th>
                      <th scope="col" data-field="usage">용도</th>
                      <th scope="col" data-field="parking">주차</th>
                      <th scope="col" data-field="add">주소</th>
                      <!-- <th scope="col" data-field="link">링크</th> -->
                      <th scope="col" data-field="note">비고</th>
                    </tr>
                  </thead>
              </table>
        </div>
    </div>


<script src="https://cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
<script src="https://unpkg.com/bootstrap-table@1.22.3/dist/bootstrap-table.min.js"></script>
<script>
    // factory
    // 37.5222797 126.708793
    var mapOptions = {
        center: new naver.maps.LatLng(37.5222797, 126.708793 ),
        zoom: 12,
        zoomControl: true,
        zoomControlOptions: {
            style: naver.maps.ZoomControlStyle.SMALL,
            position: naver.maps.Position.TOP_RIGHT
        }
    };

    var map = new naver.maps.Map('map', mapOptions);

    window.navermap_authFailure = function () {
        //alert("failed to authenticate");
    }
    
</script>
<script>
    $(function(){
        // read json
        $.getJSON( "data1.json", function( data ) {
            var items = [];
            $.each(data, function( key, row ) {
                if(row.add != null){
                    let lat = row.add.split(',')[0];
                    let long = row.add.split(',')[1];

                    makeMarker(lat, long, row.num);
                    items.push( "<li id='" + key + "'>" + row.name + " | " + lat  + ", "+ long+ "<span class='badge text-bg-secondary'>4</span>"+"</li>" );
                }
            });
            
            $( "<ul/>", {
                "class": "my-new-list",
                html: items.join( "" )
            }).appendTo( "body" );
        });

        // set markers
        

        // ##############
        // functions
        function getClickHandler(marker, infoWindow) {
            console.log("marker ")
            return function(e) {
                if (infoWindow.getMap()) {
                    infoWindow.close();
                } else {
                    infoWindow.open(map, marker);
                }
            }
        } 

        function makeMarker(lat, long, index){
            // var icon = {
            //     url: 'https://navermaps.github.io/maps.js.ncp/docs/img/example/sp_pins_spot_v3.png',
            //     size: new naver.maps.Size(24, 37),
            //     anchor: new naver.maps.Point(12, 37),
            //     origin: new naver.maps.Point(i * 29, 0)
            // };

            var marker = new naver.maps.Marker({
                position: new naver.maps.LatLng(lat, long),
                map: map,
                icon: {
                content: [
                    '<span class="badge rounded-pill text-bg-secondary">'+index+'</span>',
                        ].join(''),
                size: new naver.maps.Size(38, 58),
                anchor: new naver.maps.Point(19, 58),
            },
            });

            var infoWindow = new naver.maps.InfoWindow({
                content: '<div style="width:150px;text-align:center;padding:10px;">The Letter is <b>"'+ index +'"</b>.</div>'
            });

            naver.maps.Event.addListener(marker, 'click', getClickHandler(marker, infoWindow));
        };

    });
</script>
</body>
</html>